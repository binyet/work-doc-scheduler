"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("electron"),_=require("node:module"),m=require("node:url"),r=require("node:path");var s=typeof document<"u"?document.currentScript:null;const u=_.createRequire(typeof document>"u"?require("url").pathToFileURL(__filename).href:s&&s.tagName.toUpperCase()==="SCRIPT"&&s.src||new URL("main.js",document.baseURI).href),f=r.dirname(m.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:s&&s.tagName.toUpperCase()==="SCRIPT"&&s.src||new URL("main.js",document.baseURI).href)),{dialog:w}=u("electron");process.env.APP_ROOT=r.join(f,"..");const c=process.env.VITE_DEV_SERVER_URL,P=r.join(process.env.APP_ROOT,"dist-electron"),p=r.join(process.env.APP_ROOT,"dist");process.env.VITE_PUBLIC=c?r.join(process.env.APP_ROOT,"public"):p;let n,R=u("fs");function h(){n=new o.BrowserWindow({icon:r.join(process.env.VITE_PUBLIC,"electron-vite.svg"),webPreferences:{preload:r.join(f,"preload.js"),nodeIntegration:!0,contextIsolation:!0,sandbox:!1,webSecurity:!1}}),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),c?n.loadURL(c):n.loadFile(r.join(p,"index.html")),n.webContents.on("devtools-opened",()=>{n.webContents.executeJavaScript(`
      if (window.chrome && chrome.autofillPrivate) {
        // 避免自动填充API调用
      }
    `).catch(()=>{})}),process.env.NODE_ENV==="development"&&n.webContents.openDevTools()}o.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(o.app.quit(),n=null)});o.app.on("activate",()=>{o.BrowserWindow.getAllWindows().length===0&&h()});o.ipcMain.on("open-file",(l,e)=>{o.shell.openPath(e[0]).then(()=>{console.log("open file success",e[0])}).catch(t=>{console.error("open file error",e[0])})});o.ipcMain.handle("open-directory-dialog",async(l,e={})=>{const t={properties:["openDirectory","createDirectory"]};e.defaultPath&&(t.defaultPath=e.defaultPath),e.title&&(t.title=e.title);const i=await w.showOpenDialog(t);return!i.canceled&&i.filePaths.length>0?i.filePaths[0]:null});o.ipcMain.handle("copy-file",async(l,e,t)=>new Promise((i,d)=>{R.copyFile(e,t,a=>{a?d(a):i(!0)})}));o.ipcMain.handle("move-file",async(l,e,t)=>new Promise((i,d)=>{R.rename(e,t,a=>{a?d(a):i(!0)})}));o.app.whenReady().then(h);exports.MAIN_DIST=P;exports.RENDERER_DIST=p;exports.VITE_DEV_SERVER_URL=c;
